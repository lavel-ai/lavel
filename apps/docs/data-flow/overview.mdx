---
title: 'Data Flow Architecture'
description: 'Overview of data flow in the Lavel AI platform'
---

# Data Flow Architecture Overview

This document provides a high-level overview of how data flows through the Lavel AI platform, from user interactions to database operations and back to the UI.

## Architecture Principles

1. **Server-Centric Data Fetching**: Initial data is fetched on the server using Server Components and Server Actions
2. **Client-Side Interactivity**: React Query provides client-side data management for interactive updates
3. **Tenant Isolation**: All data operations respect tenant boundaries
4. **Type Safety**: TypeScript ensures type safety throughout the data flow
5. **Multi-level Caching**: Caching at server, client, and database levels improves performance

## System Context Diagram

<Frame>
  <img src="/images/guides/data-flow-overview.png" alt="Data Flow Overview" />
</Frame>

## Data Flow Layers

The Lavel AI platform implements a layered approach to data flow:

### 1. User Interface Layer
- **Server Components**: Render on the server with direct database access
- **Client Components**: Handle user interactions and state updates

### 2. Data Management Layer
- **Server Actions**: Handle data operations on the server
- **React Query**: Manages client-side data fetching, caching, and synchronization

### 3. Service Layer
- **API Services**: Abstractions for data operations
- **Normalization Pipeline**: Ensures data quality and consistency

### 4. Database Layer
- **Tenant Database**: Isolated database per tenant
- **Query Functions**: Encapsulate database operations

## Request Flow

A typical data request flows through the system as follows:

1. **Initial Page Load**:
   - User accesses a tenant URL (e.g., `mg.lavel.ai/cases`)
   - Authentication middleware validates the session
   - Server Components fetch initial data via Server Actions
   - HTML with data is sent to the browser

2. **Tenant Identification**:
   - The tenant is extracted from the request hostname
   - The appropriate database connection is established
   - All data operations are scoped to the tenant's database

3. **Interactive Updates**:
   - Client Components use React Query for data fetching and mutations
   - Server Actions handle database operations
   - React Query manages caching and UI updates

## Cross-Cutting Concerns

Several cross-cutting concerns are integrated throughout the data flow:

### Authentication and Authorization
- Clerk provides authentication services
- Tenant routing ensures users access only their organization's data
- User roles determine access permissions within a tenant

### Error Handling and Tracking
- Comprehensive error tracking with Sentry
- Standardized error responses from Server Actions
- Error boundaries in the UI for graceful degradation

### Analytics and Monitoring
- User actions are tracked via the analytics system
- Performance metrics are collected at key points
- Data quality is monitored through the normalization pipeline

### Feature Flags
- Feature availability is controlled through flags
- Tenant-specific feature rollouts are supported
- A/B testing capabilities are integrated

## Data Flow Guidelines

When implementing data flow in the Lavel AI platform, follow these guidelines:

1. **Use Server Components for Initial Data**: Fetch initial page data on the server using Server Components
2. **Use Server Actions for Data Operations**: Implement data mutations and fetches as Server Actions
3. **Implement Tenant Isolation**: All data operations must respect tenant boundaries
4. **Leverage React Query for Client Updates**: Use React Query for client-side data management
5. **Implement Proper Error Handling**: All data operations should include error handling
6. **Include Analytics Tracking**: Track important user interactions and data operations
7. **Apply Data Normalization**: Ensure data quality through the normalization pipeline

## Next Steps

To learn more about specific aspects of the data flow architecture, explore these detailed guides:

- [Server-Side Data Flow](/data-flow/server-side)
- [Client-Side Data Flow](/data-flow/client-side)
- [Cross-Cutting Concerns](/data-flow/cross-cutting)
- [Data Flow Examples](/data-flow/examples)